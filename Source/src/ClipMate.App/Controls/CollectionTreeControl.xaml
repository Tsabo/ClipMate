<UserControl x:Class="ClipMate.App.Controls.CollectionTreeControl"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:dxg="http://schemas.devexpress.com/winfx/2008/xaml/grid"
             xmlns:emoji="clr-namespace:Emoji.Wpf;assembly=Emoji.Wpf"
             mc:Ignorable="d"
             d:DesignHeight="450" d:DesignWidth="250">
    <UserControl.InputBindings>
        <!-- Keyboard shortcuts for Move Up/Down -->
        <KeyBinding Key="OemPlus" Command="{Binding MoveUpCommand}" />
        <KeyBinding Key="Add" Command="{Binding MoveUpCommand}" />
        <KeyBinding Key="OemMinus" Command="{Binding MoveDownCommand}" />
        <KeyBinding Key="Subtract" Command="{Binding MoveDownCommand}" />
    </UserControl.InputBindings>

    <!-- DevExpress TreeViewControl for hierarchical collection tree -->
    <dxg:TreeViewControl x:Name="TreeView"
                         ItemsSource="{Binding RootNodes}"
                         TreeViewFieldName="Name"
                         ImageFieldName="IconImage"
                         ChildNodesPath="Children"
                         ShowBorder="True"
                         TreeLineStyle="Solid"
                         SelectedItem="{Binding SelectedNode, Mode=TwoWay}"
                         ShowNodeImages="True"
                         AllowDragDrop="True"
                         AutoExpandOnDrag="True"
                         DragRecordOver="TreeView_DragRecordOver"
                         DropRecord="TreeView_DropRecord"
                         CompleteRecordDragDrop="TreeView_CompleteRecordDragDrop">
        <dxg:TreeViewControl.NodeContentTemplate>
            <DataTemplate>
                <TextBlock Text="{Binding Row.Name}">
                    <TextBlock.Style>
                        <Style TargetType="TextBlock">
                            <Style.Triggers>
                                <!-- ReadOnly collections: Red foreground (only for CollectionTreeNode) -->
                                <DataTrigger Binding="{Binding Row.Collection.IsReadOnly, FallbackValue=False}"
                                             Value="True">
                                    <Setter Property="Foreground" Value="Maroon" />
                                </DataTrigger>
                                <!-- Safe collections (PurgePolicy=Never): Underline (only for CollectionTreeNode) -->
                                <DataTrigger Binding="{Binding Row.Collection.PurgePolicy, FallbackValue=KeepLast}"
                                             Value="Never">
                                    <Setter Property="TextDecorations" Value="Underline" />
                                </DataTrigger>
                            </Style.Triggers>
                        </Style>
                    </TextBlock.Style>
                </TextBlock>
            </DataTemplate>
        </dxg:TreeViewControl.NodeContentTemplate>

        <!-- Context Menu -->
        <dxg:TreeViewControl.ContextMenu>
            <ContextMenu DataContext="{Binding PlacementTarget.DataContext, RelativeSource={RelativeSource Self}}">
                <!-- Move Up/Down -->
                <MenuItem Header="Move Up In Sort Order"
                          InputGestureText="(+)"
                          Command="{Binding DataContext.MoveUpCommand, RelativeSource={RelativeSource AncestorType=UserControl}}">
                    <MenuItem.Icon>
                        <emoji:TextBlock Text="â¬†ï¸" FontSize="14" />
                    </MenuItem.Icon>
                </MenuItem>
                <MenuItem Header="Move Down In Sort Order"
                          InputGestureText="(-)"
                          Command="{Binding DataContext.MoveDownCommand, RelativeSource={RelativeSource AncestorType=UserControl}}">
                    <MenuItem.Icon>
                        <emoji:TextBlock Text="â¬‡ï¸" FontSize="14" />
                    </MenuItem.Icon>
                </MenuItem>

                <!-- Add New Collection -->
                <MenuItem Header="Add New Collection">
                    <MenuItem.Icon>
                        <emoji:TextBlock Text="ðŸ“" FontSize="14" />
                    </MenuItem.Icon>
                </MenuItem>

                <!-- Delete Collection -->
                <MenuItem Header="Delete Collection">
                    <MenuItem.Icon>
                        <emoji:TextBlock Text="ðŸ—‘ï¸" FontSize="14" />
                    </MenuItem.Icon>
                </MenuItem>

                <!-- Database Operations -->
                <MenuItem Header="Activate Database">
                    <MenuItem.Icon>
                        <emoji:TextBlock Text="âœ…" FontSize="14" />
                    </MenuItem.Icon>
                </MenuItem>
                <MenuItem Header="De-Activate Database">
                    <MenuItem.Icon>
                        <emoji:TextBlock Text="â›”" FontSize="14" />
                    </MenuItem.Icon>
                </MenuItem>

                <!-- Tree Operations -->
                <MenuItem Header="Expand All">
                    <MenuItem.Icon>
                        <emoji:TextBlock Text="âž•" FontSize="14" />
                    </MenuItem.Icon>
                </MenuItem>
                <MenuItem Header="Collapse All">
                    <MenuItem.Icon>
                        <emoji:TextBlock Text="âž–" FontSize="14" />
                    </MenuItem.Icon>
                </MenuItem>
                <MenuItem Header="Show All Clips In All Children">
                    <MenuItem.Icon>
                        <emoji:TextBlock Text="ðŸ“‚" FontSize="14" />
                    </MenuItem.Icon>
                </MenuItem>

                <MenuItem Header="Cancel">
                    <MenuItem.Icon>
                        <emoji:TextBlock Text="âŒ" FontSize="14" />
                    </MenuItem.Icon>
                </MenuItem>

                <Separator />

                <!-- Properties -->
                <MenuItem Header="Properties"
                          Command="{Binding ShowPropertiesCommand}">
                    <MenuItem.Icon>
                        <emoji:TextBlock Text="âš™ï¸" FontSize="14" />
                    </MenuItem.Icon>
                </MenuItem>
            </ContextMenu>
        </dxg:TreeViewControl.ContextMenu>
    </dxg:TreeViewControl>
</UserControl>
