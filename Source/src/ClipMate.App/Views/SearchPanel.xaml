<UserControl x:Class="ClipMate.App.Views.SearchPanel"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" 
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008" 
             xmlns:ui="http://schemas.lepo.co/wpfui/2022/xaml"
             xmlns:local="clr-namespace:ClipMate.App.Views"
             xmlns:vm="clr-namespace:ClipMate.App.ViewModels"
             xmlns:converters="clr-namespace:ClipMate.App.Converters"
             mc:Ignorable="d" 
             d:DesignHeight="120" d:DesignWidth="800"
             Background="#252526">
    <UserControl.Resources>
        <converters:StringToVisibilityConverter x:Key="StringToVisibilityConverter"/>
        <converters:BooleanToVisibilityConverter x:Key="BooleanToVisibilityConverter"/>
        <Style x:Key="SearchButtonStyle" TargetType="Button">
            <Setter Property="Background" Value="#007ACC"/>
            <Setter Property="Foreground" Value="White"/>
            <Setter Property="BorderThickness" Value="0"/>
            <Setter Property="Padding" Value="12,6"/>
            <Setter Property="Margin" Value="4,0"/>
            <Setter Property="Cursor" Value="Hand"/>
            <Setter Property="FontSize" Value="13"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="Button">
                        <Border Background="{TemplateBinding Background}" 
                                BorderBrush="{TemplateBinding BorderBrush}"
                                BorderThickness="{TemplateBinding BorderThickness}"
                                CornerRadius="2">
                            <ContentPresenter HorizontalAlignment="Center" 
                                            VerticalAlignment="Center"
                                            Margin="{TemplateBinding Padding}"/>
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter Property="Background" Value="#1C97EA"/>
                            </Trigger>
                            <Trigger Property="IsPressed" Value="True">
                                <Setter Property="Background" Value="#005A9E"/>
                            </Trigger>
                            <Trigger Property="IsEnabled" Value="False">
                                <Setter Property="Background" Value="#3E3E42"/>
                                <Setter Property="Foreground" Value="#656565"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <Style x:Key="FilterCheckBoxStyle" TargetType="CheckBox">
            <Setter Property="Foreground" Value="#CCCCCC"/>
            <Setter Property="Margin" Value="8,0"/>
            <Setter Property="VerticalAlignment" Value="Center"/>
        </Style>

        <Style x:Key="LabelStyle" TargetType="TextBlock">
            <Setter Property="Foreground" Value="#CCCCCC"/>
            <Setter Property="FontSize" Value="12"/>
            <Setter Property="VerticalAlignment" Value="Center"/>
            <Setter Property="Margin" Value="8,0,4,0"/>
        </Style>
    </UserControl.Resources>

    <Grid Margin="8">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="8"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <!-- Search Box Row -->
        <Grid Grid.Row="0">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="Auto"/>
                <ColumnDefinition Width="Auto"/>
            </Grid.ColumnDefinitions>

            <!-- Search TextBox with Icon -->
            <Border Grid.Column="0" 
                    Background="#3E3E42" 
                    BorderBrush="#555555" 
                    BorderThickness="1" 
                    CornerRadius="2"
                    Height="32">
                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="Auto"/>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="Auto"/>
                    </Grid.ColumnDefinitions>

                    <!-- Search Icon -->
                    <TextBlock Grid.Column="0" 
                              Text="ðŸ”" 
                              FontSize="14"
                              Foreground="#858585"
                              VerticalAlignment="Center"
                              Margin="8,0,4,0"/>

                    <!-- Search TextBox -->
                    <TextBox Grid.Column="1"
                            Text="{Binding SearchText, UpdateSourceTrigger=PropertyChanged}"
                            Background="Transparent"
                            Foreground="#CCCCCC"
                            BorderThickness="0"
                            VerticalAlignment="Center"
                            FontSize="13"
                            Padding="4,0">
                        <TextBox.InputBindings>
                            <KeyBinding Key="Enter" Command="{Binding SearchCommand}"/>
                        </TextBox.InputBindings>
                    </TextBox>

                    <!-- Clear Button -->
                    <Button Grid.Column="2"
                           Content="âœ•"
                           Command="{Binding ClearSearchCommand}"
                           Background="Transparent"
                           Foreground="#858585"
                           BorderThickness="0"
                           Padding="8,0"
                           Cursor="Hand"
                           FontSize="14"
                           ToolTip="Clear search"
                           Visibility="{Binding SearchText, Converter={StaticResource StringToVisibilityConverter}}">
                        <Button.Style>
                            <Style TargetType="Button">
                                <Setter Property="Template">
                                    <Setter.Value>
                                        <ControlTemplate TargetType="Button">
                                            <ContentPresenter/>
                                            <ControlTemplate.Triggers>
                                                <Trigger Property="IsMouseOver" Value="True">
                                                    <Setter Property="Foreground" Value="White"/>
                                                </Trigger>
                                            </ControlTemplate.Triggers>
                                        </ControlTemplate>
                                    </Setter.Value>
                                </Setter>
                            </Style>
                        </Button.Style>
                    </Button>
                </Grid>
            </Border>

            <!-- Search Button -->
            <Button Grid.Column="1" 
                    Content="Search"
                    Command="{Binding SearchCommand}"
                    Style="{StaticResource SearchButtonStyle}"/>

            <!-- Results Count -->
            <TextBlock Grid.Column="2"
                      Foreground="#CCCCCC"
                      FontSize="12"
                      VerticalAlignment="Center"
                      Margin="12,0,0,0">
                <Run Text="{Binding TotalMatches, Mode=OneWay}"/>
                <Run Text=" results"/>
            </TextBlock>
        </Grid>

        <!-- Filters Row -->
        <StackPanel Grid.Row="2" Orientation="Horizontal">
            <!-- Content Type Filters -->
            <TextBlock Text="Type:" Style="{StaticResource LabelStyle}"/>
            <CheckBox Content="Text" IsChecked="{Binding FilterByText}" Style="{StaticResource FilterCheckBoxStyle}"/>
            <CheckBox Content="Image" IsChecked="{Binding FilterByImage}" Style="{StaticResource FilterCheckBoxStyle}"/>
            <CheckBox Content="Files" IsChecked="{Binding FilterByFiles}" Style="{StaticResource FilterCheckBoxStyle}"/>

            <!-- Separator -->
            <Border Width="1" Height="20" Background="#555555" Margin="12,0"/>

            <!-- Date Range -->
            <TextBlock Text="From:" Style="{StaticResource LabelStyle}"/>
            <DatePicker SelectedDate="{Binding DateFrom}"
                       Width="120"
                       Margin="4,0,8,0"
                       Background="#3E3E42"
                       Foreground="#CCCCCC"
                       BorderBrush="#555555"/>

            <TextBlock Text="To:" Style="{StaticResource LabelStyle}"/>
            <DatePicker SelectedDate="{Binding DateTo}"
                       Width="120"
                       Margin="4,0,8,0"
                       Background="#3E3E42"
                       Foreground="#CCCCCC"
                       BorderBrush="#555555"/>

            <!-- Separator -->
            <Border Width="1" Height="20" Background="#555555" Margin="12,0"/>

            <!-- Search Options -->
            <CheckBox Content="Case Sensitive" IsChecked="{Binding IsCaseSensitive}" Style="{StaticResource FilterCheckBoxStyle}"/>
            <CheckBox Content="Regex" IsChecked="{Binding IsRegex}" Style="{StaticResource FilterCheckBoxStyle}"/>

            <!-- Loading Indicator -->
            <TextBlock Text="ðŸ”„ Searching..." 
                      Foreground="#007ACC"
                      FontSize="12"
                      VerticalAlignment="Center"
                      Margin="12,0,0,0"
                      Visibility="{Binding IsSearching, Converter={StaticResource BooleanToVisibilityConverter}}"/>
        </StackPanel>
    </Grid>
</UserControl>
