<UserControl x:Class="ClipMate.App.Views.SearchPanel"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" 
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008" 
             xmlns:local="clr-namespace:ClipMate.App.Views"
             xmlns:vm="clr-namespace:ClipMate.App.ViewModels"
             xmlns:converters="clr-namespace:ClipMate.App.Converters"
             xmlns:dxmvvm="http://schemas.devexpress.com/winfx/2008/xaml/mvvm"
             mc:Ignorable="d" 
             d:DesignHeight="120" d:DesignWidth="800">
    <UserControl.Resources>
        <dxmvvm:StringToVisibilityConverter x:Key="StringToVisibilityConverter"/>
        <dxmvvm:BooleanToVisibilityConverter x:Key="BooleanToVisibilityConverter"/>
    </UserControl.Resources>

    <Grid Margin="8">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="8"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <!-- Search Box Row -->
        <Grid Grid.Row="0">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="Auto"/>
                <ColumnDefinition Width="Auto"/>
            </Grid.ColumnDefinitions>

            <!-- Search TextBox with Icon -->
            <Border Grid.Column="0" 
                    BorderThickness="1" 
                    CornerRadius="2"
                    Height="32">
                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="Auto"/>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="Auto"/>
                    </Grid.ColumnDefinitions>

                    <!-- Search Icon -->
                    <TextBlock Grid.Column="0" 
                              Text="ðŸ”"
                              VerticalAlignment="Center"
                              Margin="8,0,4,0"/>

                    <!-- Search TextBox -->
                    <TextBox Grid.Column="1"
                            Text="{Binding SearchText, UpdateSourceTrigger=PropertyChanged}"
                            BorderThickness="0"
                            VerticalAlignment="Center"
                            Padding="4,0">
                        <TextBox.InputBindings>
                            <KeyBinding Key="Enter" Command="{Binding SearchCommand}"/>
                        </TextBox.InputBindings>
                    </TextBox>

                    <!-- Clear Button -->
                    <Button Grid.Column="2"
                           Content="âœ•"
                           Command="{Binding ClearSearchCommand}"
                           BorderThickness="0"
                           Padding="8,0"
                           Cursor="Hand"
                           ToolTip="Clear search"
                           Visibility="{Binding SearchText, Converter={StaticResource StringToVisibilityConverter}}"/>
                </Grid>
            </Border>

            <!-- Search Button -->
            <Button Grid.Column="1" 
                    Content="Search"
                    Command="{Binding SearchCommand}"/>

            <!-- Results Count -->
            <TextBlock Grid.Column="2"
                      VerticalAlignment="Center"
                      Margin="12,0,0,0">
                <Run Text="{Binding TotalMatches, Mode=OneWay}"/>
                <Run Text=" results"/>
            </TextBlock>
        </Grid>

        <!-- Filters Row -->
        <StackPanel Grid.Row="2" Orientation="Horizontal">
            <!-- Content Type Filters -->
            <TextBlock Text="Type:" />
            <CheckBox Content="Text" IsChecked="{Binding FilterByText}" />
            <CheckBox Content="Image" IsChecked="{Binding FilterByImage}" />
            <CheckBox Content="Files" IsChecked="{Binding FilterByFiles}" />

            <!-- Separator -->
            <Border Width="1" Height="20" Margin="12,0"/>

            <!-- Date Range -->
            <TextBlock Text="From:" />
            <DatePicker SelectedDate="{Binding DateFrom}"
                       Width="120"
                       Margin="4,0,8,0"/>

            <TextBlock Text="To:" />
            <DatePicker SelectedDate="{Binding DateTo}"
                       Width="120"
                       Margin="4,0,8,0"/>

            <!-- Separator -->
            <Border Width="1" Height="20" Margin="12,0"/>

            <!-- Search Options -->
            <CheckBox Content="Case Sensitive" IsChecked="{Binding IsCaseSensitive}" />
            <CheckBox Content="Regex" IsChecked="{Binding IsRegex}" />

            <!-- Loading Indicator -->
            <TextBlock Text="ðŸ”„ Searching..." 
                      VerticalAlignment="Center"
                      Margin="12,0,0,0"
                      Visibility="{Binding IsSearching, Converter={StaticResource BooleanToVisibilityConverter}}"/>
        </StackPanel>
    </Grid>
</UserControl>
