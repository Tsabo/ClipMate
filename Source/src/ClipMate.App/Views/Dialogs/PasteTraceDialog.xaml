<dx:ThemedWindow x:Class="ClipMate.App.Views.Dialogs.PasteTraceDialog"
                 xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
                 xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
                 xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
                 xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
                 xmlns:dx="http://schemas.devexpress.com/winfx/2008/xaml/core"
                 xmlns:dxb="http://schemas.devexpress.com/winfx/2008/xaml/bars"
                 xmlns:dxe="http://schemas.devexpress.com/winfx/2008/xaml/editors"
                 xmlns:dxg="http://schemas.devexpress.com/winfx/2008/xaml/grid"
                 xmlns:dxlc="http://schemas.devexpress.com/winfx/2008/xaml/layoutcontrol"
                 xmlns:vm="clr-namespace:ClipMate.App.ViewModels"
                 mc:Ignorable="d"
                 d:DataContext="{d:DesignInstance Type=vm:PasteTraceViewModel}"
                 Title="Paste Trace"
                 Width="700"
                 Height="500"
                 MinWidth="500"
                 MinHeight="350"
                 WindowStartupLocation="CenterOwner"
                 ResizeMode="CanResize"
                 ShowInTaskbar="False"
                 Closing="OnClosing">

    <dx:ThemedWindow.Resources>
        <BooleanToVisibilityConverter x:Key="BoolToVis" />
    </dx:ThemedWindow.Resources>

    <!-- Dialog Buttons -->
    <dx:ThemedWindow.DialogButtons>
        <dx:ThemedWindowDialogButton Content="Close"
                                     IsCancel="True"
                                     Click="CancelButton_OnClick" />
        <dx:ThemedWindowDialogButton Content="Help" />
    </dx:ThemedWindow.DialogButtons>

    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto" />
            <RowDefinition Height="*" />
            <RowDefinition Height="Auto" />
        </Grid.RowDefinitions>

        <!-- Toolbar -->
        <dxb:ToolBarControl Grid.Row="0">
            <dxb:BarButtonItem Content="Start Trace"
                               Command="{Binding StartTraceCommand}"
                               Glyph="{dx:DXImage 'SvgImages/Actions/Play.svg'}" />
            <dxb:BarButtonItem Content="Stop Trace"
                               Command="{Binding StopTraceCommand}"
                               Glyph="{dx:DXImage 'SvgImages/Actions/Stop.svg'}" />
            <dxb:BarItemSeparator />
            <dxb:BarButtonItem Content="Copy Results"
                               Command="{Binding CopyResultsCommand}"
                               Glyph="{dx:DXImage 'SvgImages/Edit/Copy.svg'}" />
            <dxb:BarItemSeparator />
            <!-- Tracing status indicator -->
            <dxb:BarStaticItem>
                <dxb:BarStaticItem.ContentTemplate>
                    <DataTemplate>
                        <StackPanel Orientation="Horizontal"
                                    Visibility="{Binding DataContext.IsTracing, Converter={StaticResource BoolToVis}, RelativeSource={RelativeSource AncestorType=dx:ThemedWindow}}">
                            <Ellipse Width="10" Height="10" Fill="LimeGreen" Margin="0,0,6,0" />
                            <TextBlock Text="TRACING" FontWeight="Bold" Foreground="Green" />
                        </StackPanel>
                    </DataTemplate>
                </dxb:BarStaticItem.ContentTemplate>
            </dxb:BarStaticItem>
        </dxb:ToolBarControl>

        <!-- Main Content -->
        <dxlc:LayoutControl Grid.Row="1" Orientation="Vertical" Padding="8">
            <!-- Instructions -->
            <dxlc:LayoutGroup Header="Instructions" View="GroupBox" Orientation="Vertical" Height="160">
                <TextBlock TextWrapping="Wrap">
                    <Run FontWeight="SemiBold">How to use:</Run>
                    <LineBreak />
                    <Run>1. Copy something to the clipboard (the content you want to trace).</Run>
                    <LineBreak />
                    <Run>2. Click "Start Trace" to begin monitoring clipboard format requests.</Run>
                    <LineBreak />
                    <Run>3. Switch to your target application and paste (Ctrl+V).</Run>
                    <LineBreak />
                    <Run>4. The grid below will show which clipboard formats were requested.</Run>
                    <LineBreak />
                    <Run FontStyle="Italic" Foreground="Gray">Note: The paste will fail since we're tracing, not providing data. To trace again, copy new content first.</Run>
                </TextBlock>
            </dxlc:LayoutGroup>

            <!-- Trace Results Grid -->
            <dxlc:LayoutGroup Header="Format Requests" View="GroupBox" Orientation="Vertical"
                              VerticalAlignment="Stretch">
                <dxg:GridControl ItemsSource="{Binding TraceEntries}"
                                 AutoGenerateColumns="None">
                    <dxg:GridControl.View>
                        <dxg:TableView AllowEditing="False"
                                       ShowGroupPanel="False"
                                       AutoWidth="False" />
                    </dxg:GridControl.View>
                    <dxg:GridControl.Columns>
                        <dxg:GridColumn FieldName="Timestamp"
                                        Header="Time">
                            <dxg:GridColumn.EditSettings>
                                <dxe:TextEditSettings DisplayFormat="HH:mm:ss.fff" />
                            </dxg:GridColumn.EditSettings>
                        </dxg:GridColumn>
                        <dxg:GridColumn FieldName="FormatId"
                                        Header="Format ID" />
                        <dxg:GridColumn FieldName="FormatName"
                                        Header="Format Name" />
                        <dxg:GridColumn FieldName="RequestingApplication"
                                        Header="Requesting App" />
                    </dxg:GridControl.Columns>
                </dxg:GridControl>
            </dxlc:LayoutGroup>
        </dxlc:LayoutControl>

        <!-- Status Bar -->
        <dxb:BarContainerControl ContainerType="Bottom" Grid.Row="2">
            <dxb:StatusBarControl>
                <dxb:BarStaticItem Content="{Binding TraceEntries.Count, StringFormat='Format requests: {0}'}" />
                <dxb:BarStaticItem Alignment="Far">
                    <dxb:BarStaticItem.ContentTemplate>
                        <DataTemplate>
                            <TextBlock
                                Text="{Binding DataContext.TargetApplication, StringFormat='Target: {0}', RelativeSource={RelativeSource AncestorType=dx:ThemedWindow}}"
                                Visibility="{Binding DataContext.IsTracing, Converter={StaticResource BoolToVis}, RelativeSource={RelativeSource AncestorType=dx:ThemedWindow}}" />
                        </DataTemplate>
                    </dxb:BarStaticItem.ContentTemplate>
                </dxb:BarStaticItem>
            </dxb:StatusBarControl>
        </dxb:BarContainerControl>
    </Grid>
</dx:ThemedWindow>
