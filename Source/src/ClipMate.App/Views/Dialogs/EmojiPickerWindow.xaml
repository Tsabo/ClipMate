<dx:ThemedWindow x:Class="ClipMate.App.Views.Dialogs.EmojiPickerWindow"
                 xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
                 xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
                 xmlns:dx="http://schemas.devexpress.com/winfx/2008/xaml/core"
                 xmlns:dxe="http://schemas.devexpress.com/winfx/2008/xaml/editors"
                 xmlns:emoji="clr-namespace:Emoji.Wpf;assembly=Emoji.Wpf"
                 Title="Select Icon"
                 Width="420"
                 Height="520"
                 WindowStartupLocation="CenterOwner"
                 ResizeMode="NoResize"
                 ShowInTaskbar="False">

    <dx:ThemedWindow.DialogButtons>
        <dx:ThemedWindowDialogButton Content="OK"
                                     IsDefault="True"
                                     Click="OkButton_Click" />
        <dx:ThemedWindowDialogButton Content="Cancel"
                                     IsCancel="True"
                                     DialogResult="Cancel" />
    </dx:ThemedWindow.DialogButtons>

    <Grid Margin="0">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto" />
            <RowDefinition Height="Auto" />
            <RowDefinition Height="*" />
            <RowDefinition Height="Auto" />
        </Grid.RowDefinitions>

        <!-- Search Bar -->
        <dxe:TextEdit Grid.Row="0"
                      Margin="10,10,10,5"
                      Text="{Binding SearchText, UpdateSourceTrigger=PropertyChanged}"
                      NullText="Find something fun"
                      ShowBorder="True" />

        <!-- Recent Section -->
        <Grid Grid.Row="1" Margin="10,5,10,5"
              Visibility="{Binding RecentEmojis.Count, Converter={StaticResource CountToVisibilityConverter}}">
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto" />
                <RowDefinition Height="Auto" />
            </Grid.RowDefinitions>

            <TextBlock Grid.Row="0"
                       Text="Recent"
                       FontSize="11"
                       Foreground="Gray"
                       Margin="0,0,0,5" />

            <ItemsControl Grid.Row="1" ItemsSource="{Binding RecentEmojis}">
                <ItemsControl.ItemsPanel>
                    <ItemsPanelTemplate>
                        <WrapPanel />
                    </ItemsPanelTemplate>
                </ItemsControl.ItemsPanel>
                <ItemsControl.ItemTemplate>
                    <DataTemplate>
                        <Button Width="40" Height="40"
                                Background="Transparent"
                                BorderBrush="Transparent"
                                Padding="0"
                                ToolTip="{Binding Name}"
                                Command="{Binding DataContext.SelectEmojiCommand, RelativeSource={RelativeSource AncestorType=dx:ThemedWindow}}"
                                CommandParameter="{Binding}">
                            <Image Width="28" Height="28" emoji:Image.Source="{Binding Text}" />
                        </Button>
                    </DataTemplate>
                </ItemsControl.ItemTemplate>
            </ItemsControl>
        </Grid>

        <!-- Emoji Grid -->
        <ScrollViewer Grid.Row="2"
                      VerticalScrollBarVisibility="Auto"
                      HorizontalScrollBarVisibility="Disabled"
                      Margin="10,5,10,5">
            <ItemsControl ItemsSource="{Binding DisplayedEmojis}">
                <ItemsControl.ItemsPanel>
                    <ItemsPanelTemplate>
                        <WrapPanel />
                    </ItemsPanelTemplate>
                </ItemsControl.ItemsPanel>
                <ItemsControl.ItemTemplate>
                    <DataTemplate>
                        <Button Width="40" Height="40"
                                Background="Transparent"
                                BorderBrush="Transparent"
                                Padding="0"
                                ToolTip="{Binding Name}"
                                Command="{Binding DataContext.SelectEmojiCommand, RelativeSource={RelativeSource AncestorType=dx:ThemedWindow}}"
                                CommandParameter="{Binding}">
                            <Image Width="28" Height="28" emoji:Image.Source="{Binding Text}" />
                        </Button>
                    </DataTemplate>
                </ItemsControl.ItemTemplate>
            </ItemsControl>
        </ScrollViewer>

        <!-- Category Buttons at Bottom -->
        <Border Grid.Row="3"
                BorderThickness="0,1,0,0"
                BorderBrush="{DynamicResource {x:Static SystemColors.ControlLightBrushKey}}"
                Background="{DynamicResource {x:Static SystemColors.ControlBrushKey}}"
                Padding="5">
            <ItemsControl ItemsSource="{Binding Categories}">
                <ItemsControl.ItemsPanel>
                    <ItemsPanelTemplate>
                        <WrapPanel HorizontalAlignment="Center" />
                    </ItemsPanelTemplate>
                </ItemsControl.ItemsPanel>
                <ItemsControl.ItemTemplate>
                    <DataTemplate>
                        <Button Width="36" Height="36"
                                Margin="2"
                                Background="Transparent"
                                BorderThickness="0"
                                Padding="0"
                                ToolTip="{Binding Name}"
                                Command="{Binding DataContext.SelectCategoryCommand, RelativeSource={RelativeSource AncestorType=dx:ThemedWindow}}"
                                CommandParameter="{Binding}">
                            <Button.Style>
                                <Style TargetType="Button">
                                    <Setter Property="Opacity" Value="0.6" />
                                    <Style.Triggers>
                                        <Trigger Property="IsMouseOver" Value="True">
                                            <Setter Property="Opacity" Value="1.0" />
                                        </Trigger>
                                        <DataTrigger Value="True">
                                            <DataTrigger.Binding>
                                                <MultiBinding Converter="{StaticResource ObjectEqualityConverter}">
                                                    <Binding RelativeSource="{RelativeSource Self}" Path="DataContext" />
                                                    <Binding
                                                        RelativeSource="{RelativeSource AncestorType=dx:ThemedWindow}"
                                                        Path="DataContext.SelectedCategory" />
                                                </MultiBinding>
                                            </DataTrigger.Binding>
                                            <Setter Property="Opacity" Value="1.0" />
                                            <Setter Property="BorderThickness" Value="0,0,0,2" />
                                            <Setter Property="BorderBrush" Value="#0078D4" />
                                        </DataTrigger>
                                    </Style.Triggers>
                                </Style>
                            </Button.Style>
                            <Image Width="24" Height="24" emoji:Image.Source="{Binding Icon}" />
                        </Button>
                    </DataTemplate>
                </ItemsControl.ItemTemplate>
            </ItemsControl>
        </Border>
    </Grid>
</dx:ThemedWindow>
