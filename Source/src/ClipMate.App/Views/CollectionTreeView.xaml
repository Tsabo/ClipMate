<UserControl x:Class="ClipMate.App.Views.CollectionTreeView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" 
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008" 
             xmlns:ui="http://schemas.lepo.co/wpfui/2022/xaml"
             xmlns:dxg="http://schemas.devexpress.com/winfx/2008/xaml/grid"
             xmlns:dx="http://schemas.devexpress.com/winfx/2008/xaml/core"
             xmlns:local="clr-namespace:ClipMate.App.Views"
             xmlns:vm="clr-namespace:ClipMate.App.ViewModels"
             mc:Ignorable="d" 
             d:DesignHeight="450" d:DesignWidth="250">
    <UserControl.Resources>
        <!-- Styles are handled in cell template directly -->
    </UserControl.Resources>

    <Grid>
        <!-- DevExpress TreeViewControl for hierarchical collection tree -->
        <dxg:TreeViewControl x:Name="TreeView"
                             ItemsSource="{Binding RootNodes}"
                             TreeViewFieldName="Name"
                             ChildNodesPath="Children"
                             ShowBorder="False"
                             SelectedItem="{Binding SelectedNode, Mode=TwoWay}">
            
            <!-- Context Menu -->
            <dxg:TreeViewControl.ContextMenu>
                <ContextMenu>
                    <!-- Collection Context Menu Items -->
                    <MenuItem Header="Add Folder">
                        <MenuItem.Style>
                            <Style TargetType="MenuItem">
                                <Setter Property="Visibility" Value="Collapsed"/>
                                <Style.Triggers>
                                    <DataTrigger Binding="{Binding PlacementTarget.DataContext.SelectedNode.NodeType, RelativeSource={RelativeSource AncestorType=ContextMenu}}" Value="Collection">
                                        <Setter Property="Visibility" Value="Visible"/>
                                    </DataTrigger>
                                </Style.Triggers>
                            </Style>
                        </MenuItem.Style>
                    </MenuItem>
                    
                    <!-- Folder Context Menu Items -->
                    <MenuItem Header="Add Subfolder">
                        <MenuItem.Style>
                            <Style TargetType="MenuItem">
                                <Setter Property="Visibility" Value="Collapsed"/>
                                <Style.Triggers>
                                    <DataTrigger Binding="{Binding PlacementTarget.DataContext.SelectedNode.NodeType, RelativeSource={RelativeSource AncestorType=ContextMenu}}" Value="Folder">
                                        <Setter Property="Visibility" Value="Visible"/>
                                    </DataTrigger>
                                </Style.Triggers>
                            </Style>
                        </MenuItem.Style>
                    </MenuItem>
                    
                    <Separator/>
                    
                    <!-- Common Menu Items -->
                    <MenuItem Header="Move Up" InputGestureText="+"/>
                    <MenuItem Header="Move Down" InputGestureText="-"/>
                    <Separator/>
                    <MenuItem Header="Rename"/>
                    <MenuItem Header="Properties"/>
                    <Separator/>
                    <MenuItem Header="Delete"/>
                </ContextMenu>
            </dxg:TreeViewControl.ContextMenu>
        </dxg:TreeViewControl>
    </Grid>
</UserControl>
