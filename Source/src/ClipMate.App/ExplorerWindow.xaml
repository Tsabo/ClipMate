<dx:ThemedWindow x:Class="ClipMate.App.ExplorerWindow"
                 xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
                 xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
                 xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
                 xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
                 xmlns:dx="http://schemas.devexpress.com/winfx/2008/xaml/core"
                 xmlns:dxb="http://schemas.devexpress.com/winfx/2008/xaml/bars"
                 xmlns:controls="clr-namespace:ClipMate.App.Controls"
                 xmlns:converters="clr-namespace:ClipMate.App.Converters"
                 xmlns:dxdo="http://schemas.devexpress.com/winfx/2008/xaml/docking"
                 xmlns:emoji="clr-namespace:Emoji.Wpf;assembly=Emoji.Wpf"
                 xmlns:helpers="clr-namespace:ClipMate.App.Helpers"
                 xmlns:local="clr-namespace:ClipMate.App"
                 mc:Ignorable="d"
                 Title="ClipMate - Clipboard Manager"
                 WindowStartupLocation="CenterScreen"
                 Height="525"
                 Width="1000"
                 MinHeight="545"
                 MinWidth="1000"
                 StateChanged="Window_StateChanged">
    <dx:ThemedWindow.Resources>
        <converters:StatusBarStatisticsConverter x:Key="StatusBarStatisticsConverter" />
    </dx:ThemedWindow.Resources>

    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto" />
            <RowDefinition Height="*" />
            <RowDefinition Height="Auto" />
            <RowDefinition Height="Auto" />
        </Grid.RowDefinitions>
        <!-- BarManager: Toolbar and Menus -->
        <dxb:BarManager x:Name="BarManager" Grid.Row="0">
            <dxb:BarManager.Bars>
                <!-- Main Toolbar -->
                <dxb:Bar Caption="Main Toolbar" IsMainMenu="False" AllowCollapse="True" GlyphSize="Large">
                    <!-- PowerPaste Button with state indicator -->
                    <dxb:BarButtonItem x:Name="PowerPasteButton"
                                       Content="PowerPaste"
                                       Command="{Binding MainMenu.PowerPasteToggleCommand}"
                                       ToolTip="Click to start PowerPaste. Click again to change direction or stop."
                                       LargeGlyph="{dx:DXImage 'SvgImages/Actions/Forward.svg'}"
                                       Glyph="{dx:DXImage 'SvgImages/Actions/Forward.svg'}" />

                    <!-- Copy to Collection Dropdown -->
                    <dxb:BarSubItem x:Name="CopyToCollectionDropdown"
                                    Content="Copy to Collection"
                                    Glyph="{helpers:CustomFontIconSource Glyph={x:Static local:Icons.CopyToCollection}, Size=24}"
                                    GetItemData="CopyToCollectionDropdown_GetItemData" />

                    <!-- Move to Collection Dropdown -->
                    <dxb:BarSubItem x:Name="MoveToCollectionDropdown"
                                    Content="Move to Collection"
                                    Glyph="{helpers:CustomFontIconSource Glyph={x:Static local:Icons.MoveToCollection}, Size=24}"
                                    GetItemData="MoveToCollectionDropdown_GetItemData" />

                    <!-- Search Button -->
                    <dxb:BarButtonItem Content="Search"
                                       Command="{Binding MainMenu.SearchCommand}"
                                       ToolTip="Search clips (Ctrl+F)"
                                       Glyph="{helpers:EmojiIconSource Emoji='ðŸ”'}" />

                    <!-- Template Dropdown -->
                    <dxb:BarSubItem x:Name="TemplateDropdown"
                                    Content="Templates"
                                    ToolTip="Select a template for clip merging"
                                    Glyph="{helpers:EmojiIconSource Emoji='ðŸ“„'}"
                                    GetItemData="TemplateDropdown_GetItemData" />
                </dxb:Bar>

                <!-- Menu Bar -->
                <dxb:Bar Caption="Main Menu" IsMainMenu="True">
                    <!-- File Menu -->
                    <dxb:BarSubItem Content="_File">
                        <dxb:BarButtonItem Content="Create New, Empty Clip" KeyGesture="Ctrl+N"
                                           Command="{Binding MainMenu.CreateNewClipCommand}" />
                        <dxb:BarButtonItem Content="Clip Properties" KeyGesture="Alt+Enter"
                                           Command="{Binding MainMenu.ClipPropertiesCommand}" />
                        <dxb:BarButtonItem Content="Rename Clip" KeyGesture="Ctrl+R"
                                           Command="{Binding MainMenu.RenameClipCommand}" />
                        <dxb:BarButtonItem Content="Delete Selected Items"
                                           Command="{Binding MainMenu.DeleteSelectedCommand}" />
                        <dxb:BarButtonItem Content="Un Delete" Command="{Binding MainMenu.UnDeleteCommand}" />
                        <dxb:BarButtonItem Content="Copy Item To Collection"
                                           Command="{Binding MainMenu.CopyToCollectionCommand}"
                                           Glyph="{helpers:CustomFontIconSource Glyph={x:Static local:Icons.CopyToCollection}}" />
                        <dxb:BarButtonItem Content="Move Item To Collection"
                                           Command="{Binding MainMenu.MoveToCollectionCommand}"
                                           Glyph="{helpers:CustomFontIconSource Glyph={x:Static local:Icons.MoveToCollection}}" />
                        <dxb:BarButtonItem Content="Export Clips (Save To Individual Files)"
                                           Command="{Binding MainMenu.ExportClipsCommand}" />
                        <dxb:BarButtonItem Content="Export Clip(s) to XML"
                                           Command="{Binding MainMenu.ExportToXmlCommand}" />
                        <dxb:BarButtonItem Content="Import Clip(s) from XML"
                                           Command="{Binding MainMenu.ImportFromXmlCommand}" />
                        <dxb:BarItemSeparator />
                        <dxb:BarButtonItem Content="Decrypt and remove encryption on selected clips"
                                           Command="{Binding MainMenu.DecryptClipsCommand}" />
                        <dxb:BarButtonItem Content="Encrypt selected clips"
                                           Command="{Binding MainMenu.EncryptClipsCommand}" />
                        <dxb:BarButtonItem Content="Forget Encryption Key"
                                           Command="{Binding MainMenu.ForgetEncryptionKeyCommand}" />
                        <dxb:BarItemSeparator />
                        <dxb:BarButtonItem Content="Properties" Command="{Binding MainMenu.ShowPropertiesCommand}" />
                        <dxb:BarButtonItem Content="Add New Collection"
                                           Command="{Binding MainMenu.AddCollectionCommand}" />
                        <dxb:BarButtonItem Content="Delete Collection"
                                           Command="{Binding MainMenu.DeleteCollectionCommand}" />
                        <dxb:BarButtonItem Content="Reload Collection" KeyGesture="Alt+R"
                                           Command="{Binding MainMenu.ReloadCollectionCommand}" />
                        <dxb:BarButtonItem Content="Resequence Sort Keys"
                                           Command="{Binding MainMenu.ResequenceSortKeysCommand}" />
                        <dxb:BarItemSeparator />
                        <dxb:BarSubItem Content="Database Maintenance">
                            <dxb:BarButtonItem Content="Backup Database..."
                                               Command="{Binding MainMenu.BackupDatabaseCommand}" />
                            <dxb:BarButtonItem Content="Restore Database..."
                                               Command="{Binding MainMenu.RestoreDatabaseCommand}" />
                            <dxb:BarItemSeparator />
                            <dxb:BarButtonItem Content="Empty Trash..." Command="{Binding MainMenu.EmptyTrashCommand}" />
                            <dxb:BarItemSeparator />
                            <dxb:BarButtonItem Content="Simple Repair (VACUUM)..."
                                               Command="{Binding MainMenu.SimpleRepairCommand}" />
                            <dxb:BarButtonItem Content="Comprehensive Repair..."
                                               Command="{Binding MainMenu.ComprehensiveRepairCommand}" />
                            <dxb:BarItemSeparator />
                            <dxb:BarButtonItem Content="Run Cleanup Now..."
                                               Command="{Binding MainMenu.RunCleanupNowCommand}" />
                        </dxb:BarSubItem>
                        <dxb:BarButtonItem Content="Activate Database"
                                           Command="{Binding MainMenu.ActivateDatabaseCommand}" />
                        <dxb:BarButtonItem Content="De-Activate Database"
                                           Command="{Binding MainMenu.DeactivateDatabaseCommand}" />
                        <dxb:BarItemSeparator />
                        <dxb:BarButtonItem Content="Print..." KeyGesture="Ctrl+P"
                                           Command="{Binding MainMenu.PrintCommand}" />
                        <dxb:BarButtonItem Content="Enable Quick Print"
                                           Command="{Binding MainMenu.EnableQuickPrintCommand}" />
                        <dxb:BarButtonItem Content="Print Options..." Command="{Binding MainMenu.PrintOptionsCommand}" />
                        <dxb:BarItemSeparator />
                        <dxb:BarButtonItem Content="Exit Program (Shut Down)" Command="{Binding MainMenu.ExitCommand}" />
                    </dxb:BarSubItem>

                    <!-- Edit Menu -->
                    <dxb:BarSubItem Content="_Edit">
                        <dxb:BarButtonItem Content="Undo" Command="{Binding MainMenu.UndoCommand}" />
                        <dxb:BarButtonItem Content="Select All Clips" Command="{Binding MainMenu.SelectAllCommand}" />
                        <dxb:BarItemSeparator />
                        <dxb:BarButtonItem Content="Capture Special..."
                                           Command="{Binding MainMenu.CaptureSpecialCommand}" />
                        <dxb:BarButtonItem Content="Append Clips Together (Glue)" KeyGesture="Ctrl+Alt+A"
                                           Command="{Binding MainMenu.AppendClipsCommand}" />
                        <dxb:BarSubItem Content="Screen Capture" />
                        <dxb:BarSubItem Content="QuickPaste" />
                        <dxb:BarItemSeparator />
                        <dxb:BarSubItem Content="Case Conversion" />
                        <dxb:BarButtonItem Content="Clean-Up Text..." Command="{Binding MainMenu.CleanUpTextCommand}" />
                        <dxb:BarButtonItem Content="Shift Left" Command="{Binding MainMenu.ShiftLeftCommand}" />
                        <dxb:BarButtonItem Content="Shift Right" Command="{Binding MainMenu.ShiftRightCommand}" />
                        <dxb:BarButtonItem Content="Remove Linebreaks" KeyGesture="Ctrl+Alt+B"
                                           Command="{Binding MainMenu.RemoveLineBreaksCommand}" />
                        <dxb:BarButtonItem Content="Check Spelling" KeyGesture="F7"
                                           Command="{Binding MainMenu.CheckSpellingCommand}" />
                        <dxb:BarButtonItem Content="Change Title and Shortcut" KeyGesture="Ctrl+R"
                                           Command="{Binding MainMenu.ChangeTitleCommand}" />
                        <dxb:BarButtonItem Content="Strip Out Non-TEXT Data Formats" KeyGesture="Ctrl+Alt+T"
                                           Command="{Binding MainMenu.StripNonTextCommand}" />
                        <dxb:BarButtonItem Content="Convert File Pointer To Text"
                                           Command="{Binding MainMenu.ConvertFilePointerCommand}" />
                        <dxb:BarButtonItem Content="Unicode To Ansi" Command="{Binding MainMenu.UnicodeToAnsiCommand}" />
                        <dxb:BarItemSeparator />
                        <dxb:BarButtonItem Content="PowerPaste Up" KeyGesture="Ctrl+U"
                                           Command="{Binding MainMenu.PowerPasteUpCommand}" />
                        <dxb:BarButtonItem Content="PowerPaste Down" KeyGesture="Ctrl+D"
                                           Command="{Binding MainMenu.PowerPasteDownCommand}" />
                        <dxb:BarCheckItem Content="PowerPaste Option - Loop" IsChecked="{Binding MainMenu.IsLoopMode}" />
                        <dxb:BarCheckItem Content="PowerPaste Option - Explode Into Fragments"
                                          IsChecked="{Binding MainMenu.IsExplodeMode}" />
                    </dxb:BarSubItem>

                    <!-- Tools Menu -->
                    <dxb:BarSubItem Content="_Tools">
                        <dxb:BarButtonItem Content="Auto Capture" KeyGesture="F12"
                                           Command="{Binding MainMenu.AutoCaptureCommand}" />
                        <dxb:BarButtonItem Content="Filter Outbound Clips"
                                           Command="{Binding MainMenu.FilterOutboundCommand}" />
                        <dxb:BarItemSeparator />
                        <dxb:BarButtonItem Content="Options..." Command="{Binding MainMenu.OptionsCommand}" />
                        <dxb:BarButtonItem Content="Application Profile..."
                                           Command="{Binding MainMenu.AppProfileCommand}" />
                        <dxb:BarButtonItem Content="Language" Command="{Binding MainMenu.LanguageCommand}" />
                        <dxb:BarButtonItem Content="Connect to ClipBar"
                                           Command="{Binding MainMenu.ConnectToClipBarCommand}" />
                        <dxb:BarItemSeparator />
                        <dxb:BarButtonItem Content="Clipboard Diagnostics..."
                                           Command="{Binding MainMenu.ClipboardDiagnosticsCommand}" />
                        <dxb:BarButtonItem Content="Trace Paste" Command="{Binding MainMenu.TracePasteCommand}" />
                        <dxb:BarButtonItem Content="Re-Establish Clipboard Connection"
                                           Command="{Binding MainMenu.ReestablishClipboardCommand}" />
                        <dxb:BarItemSeparator />
                        <!-- SQL Window: Simple button when single database -->
                        <dxb:BarButtonItem Content="Show SQL Window"
                                           Command="{Binding MainMenu.ShowSqlWindowCommand}"
                                           IsVisible="{Binding MainMenu.HasMultipleDatabases, Converter={StaticResource InverseBoolConverter}}" />
                        <!-- SQL Window: Submenu when multiple databases -->
                        <dxb:BarSubItem x:Name="ShowSqlWindowMultiple"
                                        Content="Show SQL Window"
                                        IsVisible="{Binding MainMenu.HasMultipleDatabases}"
                                        GetItemData="SqlWindowDropdown_GetItemData" />
                        <dxb:BarButtonItem Content="Show Event Log" Command="{Binding MainMenu.ShowEventLogCommand}" />
                    </dxb:BarSubItem>

                    <!-- View Menu -->
                    <dxb:BarSubItem Content="_View">
                        <dxb:BarButtonItem Content="Find (Search)..." KeyGesture="Ctrl+F"
                                           Command="{Binding MainMenu.SearchCommand}" />
                        <dxb:BarButtonItem Content="Select Previous Item (Up)" KeyGesture="Ctrl+Alt+P"
                                           Command="{Binding MainMenu.SelectPreviousCommand}" />
                        <dxb:BarButtonItem Content="Select Next Item (Down)" KeyGesture="Ctrl+Alt+N"
                                           Command="{Binding MainMenu.SelectNextCommand}" />
                        <dxb:BarItemSeparator />
                        <dxb:BarButtonItem Content="Switch To Last Collection" KeyGesture="F5"
                                           Command="{Binding MainMenu.SwitchToLastCollectionCommand}" />
                        <dxb:BarButtonItem Content="Switch to Favorite Collection" KeyGesture="F6"
                                           Command="{Binding MainMenu.SwitchToFavoriteCollectionCommand}" />
                        <dxb:BarButtonItem Content="Select Collection" KeyGesture="F8"
                                           Command="{Binding MainMenu.SelectCollectionCommand}" />
                        <dxb:BarItemSeparator />
                        <dxb:BarButtonItem Content="Open Source URL In Browser" KeyGesture="Ctrl+O"
                                           Command="{Binding MainMenu.OpenSourceUrlCommand}" />
                        <dxb:BarButtonItem Content="CharMap (Launch)" Command="{Binding MainMenu.LaunchCharMapCommand}" />
                        <dxb:BarItemSeparator />
                        <dxb:BarButtonItem Content="View Clip" KeyGesture="F2"
                                           Command="{Binding MainMenu.ViewClipCommand}" />
                        <dxb:BarButtonItem Content="Switch Between Classic / Explorer" KeyGesture="Ctrl+E"
                                           Command="{Binding MainMenu.SwitchViewCommand}" />
                        <dxb:BarButtonItem Content="Open ClipMate Explorer"
                                           Command="{Binding MainMenu.OpenExplorerCommand}" />
                        <dxb:BarButtonItem Content="Open ClipMate Classic"
                                           Command="{Binding MainMenu.OpenClassicCommand}" />
                        <dxb:BarButtonItem Content="Close And Free All Windows"
                                           Command="{Binding MainMenu.CloseAllWindowsCommand}" />
                        <dxb:BarItemSeparator />
                        <dxb:BarCheckItem Content="_Dual ClipList Mode"
                                          IsChecked="{Binding IsDualClipListMode}"
                                          KeyGesture="Ctrl+D" />
                        <dxb:BarItemSeparator />
                        <dxb:BarSubItem Content="Visibility" />
                        <dxb:BarSubItem Content="Classic Options" />
                        <dxb:BarButtonItem Content="Transparency" Command="{Binding MainMenu.TransparencyCommand}" />
                    </dxb:BarSubItem>

                    <!-- Help Menu -->
                    <dxb:BarSubItem Content="_Help">
                        <dxb:BarButtonItem Content="About ClipMate" Command="{Binding MainMenu.AboutCommand}" />
                        <dxb:BarItemSeparator />
                        <dxb:BarButtonItem Content="Documentation (GitHub Wiki)"
                                           Command="{Binding MainMenu.DocumentationCommand}" />
                        <dxb:BarButtonItem Content="View on GitHub" Command="{Binding MainMenu.ViewOnGitHubCommand}" />
                    </dxb:BarSubItem>
                </dxb:Bar>
            </dxb:BarManager.Bars>
        </dxb:BarManager>

        <!-- Main Content Area -->
        <dxdo:DockLayoutManager Grid.Row="1" AllowCustomization="False">
            <dxdo:LayoutGroup x:Name="LayoutRoot" Orientation="Vertical">

                <dxdo:LayoutGroup Orientation="Horizontal">
                    <dxdo:LayoutPanel Caption="Collections"
                                      ItemWidth="135.16*"
                                      AllowDrag="False"
                                      AllowFloat="False"
                                      AllowHide="False"
                                      ShowCaption="False"
                                      ShowCloseButton="False"
                                      ShowBorder="False">
                        <controls:CollectionTreeControl x:Name="CollectionTree"
                                                        DataContext="{Binding CollectionTree}" />
                    </dxdo:LayoutPanel>
                    <dxdo:LayoutPanel Caption="Clip List"
                                      ItemWidth="699.0*"
                                      AllowDrag="False"
                                      AllowFloat="False"
                                      AllowHide="False"
                                      ShowCaption="False"
                                      ShowCloseButton="False"
                                      ShowBorder="False">
                        <controls:ClipListControl x:Name="DockedClipListView"
                                                  Items="{Binding PrimaryClipList.Clips, Mode=OneWay}"
                                                  SelectedItem="{Binding PrimaryClipList.SelectedClip}"
                                                  SelectedItems="{Binding PrimaryClipList.SelectedClips, Mode=TwoWay}" />
                    </dxdo:LayoutPanel>
                </dxdo:LayoutGroup>

                <dxdo:LayoutPanel Caption="Preview"
                                  ItemWidth="190.84*"
                                  AllowDrag="False"
                                  AllowFloat="False"
                                  AllowHide="False"
                                  ShowCaption="False"
                                  ShowCloseButton="False"
                                  ShowBorder="False">
                    <controls:ClipViewerControl x:Name="DockedClipViewer" />
                </dxdo:LayoutPanel>
            </dxdo:LayoutGroup>

        </dxdo:DockLayoutManager>

        <!-- QuickPaste Toolbar -->
        <controls:QuickPasteToolbar x:Name="QuickPasteToolbar"
                                    Grid.Row="2"
                                    DataContext="{Binding QuickPasteToolbarViewModel}" />

        <!-- Status Bar at Bottom -->
        <dxb:BarContainerControl ContainerType="Bottom" Grid.Row="3">
            <dxb:StatusBarControl>
                <!-- Far Left: Loading progress bar (visible when loading) -->
                <!-- TODO: Implement progress tracking for clip loading
                <dxb:BarStaticItem>
                    <dxb:BarStaticItem.ContentTemplate>
                        <DataTemplate>
                            <dxe:ProgressBarEdit Width="50"
                                                 MaxWidth="200" 
                                                 Height="16" 
                                                 StyleSettings="{dxe:ProgressBarMarqueeStyleSettings}"
                                                 Visibility="{Binding IsLoading, Converter={StaticResource BoolToVisibilityConverter}}" />
                        </DataTemplate>
                    </dxb:BarStaticItem.ContentTemplate>
                </dxb:BarStaticItem>
                -->

                <!-- Left side: Status message -->
                <dxb:BarStaticItem Content="{Binding StatusMessage}">
                    <dxb:BarStaticItem.ContentTemplate>
                        <DataTemplate>
                            <emoji:TextBlock Text="{Binding}" TextTrimming="CharacterEllipsis" />
                        </DataTemplate>
                    </dxb:BarStaticItem.ContentTemplate>
                </dxb:BarStaticItem>

                <!-- Right side: Statistics (Bytes/Chars/Words or Image dimensions) -->
                <dxb:BarStaticItem Alignment="Far">
                    <dxb:BarStaticItem.Content>
                        <MultiBinding Converter="{StaticResource StatusBarStatisticsConverter}">
                            <Binding Path="TotalBytes" />
                            <Binding Path="TotalChars" />
                            <Binding Path="TotalWords" />
                            <Binding Path="IsImageSelected" />
                            <Binding Path="IsLoadingImage" />
                            <Binding Path="ImageWidth" />
                            <Binding Path="ImageHeight" />
                        </MultiBinding>
                    </dxb:BarStaticItem.Content>
                </dxb:BarStaticItem>
            </dxb:StatusBarControl>
        </dxb:BarContainerControl>
    </Grid>
</dx:ThemedWindow>
